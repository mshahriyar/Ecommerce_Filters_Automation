# Guidance for AI coding agents working on this repo

This file captures the essential, discoverable knowledge needed to be productive in the
`Ecommerce_Filters_Automation` test suite. Keep entries short, concrete, and tied to
existing files so an AI can make correct edits and add tests consistently.

## Big Picture
- Purpose: end-to-end UI tests for the Motors/Cars listing (Playwright + pytest).
- Test flow: tests log in via `pages/login_page.py`, navigate to cars via
  `pages/motors_page.py`, then interact with filter components in `components/`.
- Playwright is used in synchronous mode from `conftest.py` (`sync_playwright`).

## Key files and responsibilities
- `conftest.py` — pytest fixtures and hooks. Important: `--env` option and
  `cars_page` fixture which performs login and navigation to the Cars listing.
- `config/config.py` and `config/environments/*.json` — environment-specific values
  (base_url, email, password). Tests call `load_config(env)` via `--env`.
- `pages/` — page objects (minimal): `BasePage`, `LoginPage`, `MotorsPage`.
- `components/` — filter validators and actions (one class per feature):
  `price_filter.py`, `kilometer_filter.py`, `year_filter.py`, `region_filter.py`,
  `emirates_filter.py`, `sorting.py`, `pagination.py`, `fascination.py`.
- `tests/` — orchestrated flows that reuse component classes (see `test_filters.py`).

## Test execution and environment
- Install runtime deps from `requirements.txt`. Playwright browsers also required:

  `pip install -r requirements.txt`
  `playwright install`

- Run tests with pytest; HTML report and verbose options are enabled in `pytest.ini`.
  Example: `pytest -q` or to choose environment: `pytest --env local`.
- `conftest.py` launches Chromium with `headless=False` by default — be mindful when
  running in CI (change to `headless=True` if necessary).

## Project-specific patterns & conventions
- Page objects extend `pages/base_page.py` and use helper methods: `click`, `fill`,
  `wait_for_visible`, and `wait_for_results`. Favor these helpers rather than raw
  `page.locator(...).click()` in tests.
- Filters follow an `apply(...) -> return applied_value` and `validate(...)` pattern.
  Example: `PriceFilter.apply(min, max)` stores `_active_range` and `validate()` will
  read it when arguments are omitted. See `components/price_filter.py`.
- Selectors are mostly XPath strings stored as class constants (e.g. `FILTER_BTN`).
  Keep new locators grouped at top of component classes.
- Synchronous Playwright API is used (`playwright.sync_api`). Keep any new code
  consistent with sync API and `BasePage` helpers.
- Pagination validation uses `components/pagination.py`'s `validate_all_pages` which
  accepts callback functions: pass light-weight `validate_*` callables (no heavy state).

## Error handling & observability
- Screenshots on failure are saved via the `screenshot_on_failure` autouse fixture
  in `conftest.py` (into `reports/screenshots`) and attached to the HTML report.
- Tests print progress messages; preserve or extend these prints for clarity.

## Making changes or adding tests — practical checklist
1. Add or update selectors in `components/*` or `pages/*`. Put locators as constants.
2. Use `BasePage` helper methods (`click`, `fill`, `wait_for_results`).
3. If creating a new filter component, follow `apply()/validate()` pattern.
4. Update or add tests in `tests/` that exercise `cars_page` fixture so login/navigation
   is reused.
5. Run locally with `pytest --env local` and verify screenshots/report in `reports/`.

## Examples (copyable)
- Run a single test file:
  `pytest tests/test_filters.py --env local -k test_filters -q`
- Add a new filter component skeleton:
  - Create `components/my_filter.py` with a class extending `BasePage`.
  - Define `FILTER_BTN`, `APPLY_BTN` constants and `apply()`/`validate()` methods.

## Integration points & gotchas
- `conftest.py` calls `LoginPage.wait_for_url("https://portal-v2.qa.ayshei.io/uae/ads")` —
  tests assume these exact landing URLs. Update tests/pages together if the app path
  changes.
- Credentials and `base_url` are stored in `config/environments/*.json`. Avoid hardcoding
  credentials elsewhere.
- `pytest.ini` already configures HTML reporting (`reports/report.html`). Ensure `reports/`
  directory exists or is generated by pytest run.

If any of the above points are unclear or you want more examples (e.g. adding a CI
workflow or converting to Playwright fixtures instead of `sync_playwright`), tell me
which section to expand or update.
